parameters:
  keyvaultName: ''
  keyvaultSecret: ''
  serviceConnection: ''

steps:

  - task: AzureKeyVault@1
    displayName: Retrieve keyvault secret for ADO token
    inputs:
      ConnectedServiceName: ${{ parameters.serviceConnection }}
      keyVaultName: ${{ parameters.keyvaultName }}
      secretsFilter: ${{ parameters.keyvaultSecret }}
      runAsPreJob: false

  - task: Bash@3
    displayName: Prevent parallel run
    env:
      thisbuild: $(Build.BuildId)
      pipelinedefinition: $(System.DefinitionId)
      azuredevopstoken: $(azure-devops-token)
    inputs:
      filePath: $(System.DefaultWorkingDirectory)/pipeline-scripts/builds-check.sh